pipeline {
    agent any

    stages {
        stage('1. Build JAR') {
            steps {
                echo 'üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á Build ‡πÇ‡∏Ñ‡πâ‡∏î Spring Boot (‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå .jar)...'
                // ‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå Maven ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á Build ‡πÇ‡∏Ñ‡πâ‡∏î (‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£ Test ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏ß‡πÜ)
                sh 'chmod +x mvnw'
                sh './mvnw clean package -DskipTests'
            }
        }

        stage('2. Build Docker Image') {
            steps {
                echo 'üì¶ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏≠‡∏≤‡πÑ‡∏ü‡∏•‡πå .jar ‡∏¢‡∏±‡∏î‡πÉ‡∏™‡πà Docker Image...'
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Image ‡∏ä‡∏∑‡πà‡∏≠ springboot-api
                sh 'docker build -t springboot-api:latest .'
            }
        }

        stage('3. Deploy to VM-2 & VM-3') {
            steps {
                echo 'üåê ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô App Server...'

                // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô ---
                echo '>> ‡∏Å‡∏≥‡∏•‡∏±‡∏á Deploy ‡πÑ‡∏õ‡∏ó‡∏µ‡πà VM-2 (192.168.64.x)...'
                // TODO: ‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SSH ‡πÑ‡∏õ‡∏•‡∏ö Container ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà VM-2 ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà

                echo '>> ‡∏Å‡∏≥‡∏•‡∏±‡∏á Deploy ‡πÑ‡∏õ‡∏ó‡∏µ‡πà VM-3 (192.168.64.y)...'
                // TODO: ‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SSH ‡πÑ‡∏õ‡∏•‡∏ö Container ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà VM-3 ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà
            }
        }
    }
}